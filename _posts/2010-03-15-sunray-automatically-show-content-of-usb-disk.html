---
layout: post
title: Sunray - Automatically show content of USB disk
categories:
- linux
tags:
- automatically
- sunray
- usb disk
status: pending
type: post
published: false
meta: {}
---
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>utdiskadm/utstoraged/utmountd/etc automatically handle the creation ofdevice files during insertion and mounting of USB mass storage devices, 
but the mount point is in /tmp/SUNWut/mnt/$USER, which isn't obvious for 
the average user.
<!--more-->
I wrote a wrapper around /opt/SUNWut/lib/utdomount to create an icon to 
on a users GNOME desktop after USB insertion and delete the Icon after 
USB removal.  Additionally, a symbolic link is created/removed in the 
users home directory to make accessing the USB storage from applications 
easier.</p>
<p>cp /opt/SUNWut/lib/utdomount /opt/SUNWut/lib/utdomount.original</p>
<p>=== begin /opt/SUNWut/lib/utdomount ===</p>
<p><code>#!/bin/bash
#
# /opt/SUNWut/lib/utdomount.sh
#
# Shell wrapper around /opt/SUNWut/lib/utdomount
# Detect GNOME and put Icon on users desktop pointing to the USB mountpoint.
#
# Version: 0.1 -- Initial writing
#
# Change Log
#
# 2005/08/23, Peter Downs, 
#
# This script may be used under the terms of the GNU General
# Public License v2 (http://www.gnu.org/licenses/gpl.html)</code></p>
<p>DEBUG=1</p>
<p>if [ "$DEBUG" == "1" ]; then
         echo "### Environment ###" &gt; /tmp/domount.log
         set | sort &gt;&gt; /tmp/domount.log</p>
<p>         echo "" &gt;&gt; /tmp/domount.log
         echo "" &gt;&gt; /tmp/domount.log
         echo "" &gt;&gt; /tmp/domount.log
         echo "### Command Line ###" &gt;&gt; /tmp/domount.log
         echo $* &gt;&gt; /tmp/domount.log
fi</p>
<p>cmdopt=$*</p>
<p>while [ $# -gt 0 ]; do
arg=$1
case $arg in
         -b)
                 shift
                 dev=$1
                 ;;
         -i)
                 shift
                 id=$1
                 ;;
         -m)
                 shift
                 action=mount
                 ;;
         -u)
                 shift
                 action=unmount
                 ;;
         *)
                 shift
                 ;;
esac
done</p>
<p>if [ "$DEBUG" == "1" ]; then
         echo "Processed command line arguments" &gt;&gt;/tmp/domount.log
         echo dev=$dev &gt;&gt;/tmp/domount.log
         echo id=$id &gt;&gt; /tmp/domount.log
         echo action=$action &gt;&gt; /tmp/domount.log</p>
<p>fi</p>
<p>if [ "$id" != "" ]; then
         uid=`getent passwd $id | cut -d: -f1`
fi</p>
<p>if [ "$DEBUG" == "1" ]; then
         echo uid=$uid &gt;&gt; /tmp/domount.log
fi</p>
<p>if [ "$DEBUG" == "1" ]; then
         echo "Passing control to utdomount.original" &gt;&gt;/tmp/domount.log
fi</p>
<p>/opt/SUNWut/lib/utdomount.original $cmdopt &gt;&gt; /tmp/domount.log</p>
<p>if [ "$DEBUG" == "1" ]; then
         echo "Done with utdomount.original" &gt;&gt;/tmp/domount.log
fi</p>
<p>name=`basename $dev | sed -e 's/s2//'`
desc="Removable USB Device 1"
icon=`eval echo ~$uid`/Desktop/usb.desktop</p>
<p>echo name=$name &gt;&gt;/tmp/domount.log
echo icon=$icon &gt;&gt;/tmp/domount.log
case $action in
mount)
         # Create icon
         echo "Begin Create icon"  &gt;&gt;/tmp/domount.log
         mpath=/tmp/SUNWut/mnt/$uid/$name
         cat &gt; $icon &lt;&gt; /tmp/domount.log
         echo err=$err &gt;&gt; /tmp/domount.log
fi</p>
<p>exit $?</p>
<p>==== end /opt/SUNWut/lib/utdomount</p>
<p>chown root:sys /opt/SUNWut/lib/utdomount
chmod 4755 /opt/SUNWut/lib/utdomount</p>
</body></html>
